David, Cristian, B√©ryl, B√©n√©dicte

# Consignes
- [x] Installation vCenter Server
	- [x] Nom VCSA01, cr√©er l'h√¥te A DNS vcsa01.tssr.local
	- [x] @IP : 192.168.1.10
	- [x] Domaine SSO par d√©faut : vsphere.local
- [x] Configurer le vCenter Server
	- [x] Int√©grer le vCenter au domaine TSSR.LOCAL
	- [x] Mapper les groupes AD
	- [x] Groupe Technicien en lecture seule du vCenter
	- [x] Groupe Administrateur en droit d'administrateur du vCenter
	- [x] Tester les acc√®s avec les comptes TSSR\\technicien1 et TSSR\\administrateur1
- [x] Cr√©er un cluster
	- [x] Cr√©er un Datacenter
	- [x] Cr√©er un Cluster et y connecter les deux ESXi avec leurs noms FQDN (esxi01.tssr.local et esx02.tssr.local)
	- [ ] Activer vSphere HA et vSphere DRS, laisse les confs par d√©faut
	- [x] Est ce que le Cluster est op√©rationnel dans ces conditions ?
- [x] Cr√©er une VM Linux Debian
	- [x] Nommer Debian01
	- [x] 2 vCPU
	- [x] 2 Go RAM
	- [x] 16Go en provisionnement dynamique
	- [x] IP en DHCP
	- [x] Prise en main en mode console
	- [x] Prise en main en SSH
	- [x] Installer openvmtools
- [x] Cr√©er une VM Windows Server
	- [x] Nommer Windows01
	- [x] 2 vCPU
	- [x] 4 Go RAM
	- [x] 40Go en provisionnement dynamique
	- [x] Installer les VMware Tools
- [x] Clone - Template - Snapshot
	- [x] Cr√©er un fichier de personnalisation de VM pour windows avec sysprep et int√©gration dans le domaine tssr.local
	- [x] Clone Windows01 en Windows02 avec le fichier de personnalisation
	- [x] Est ce que Windows02 a bien √©t√© int√©grer dans le domaine automatiquement ?
	- [x] Convertir Windows01 en template et le nommer "Template-Windows-nosysprep"
	- [x] D√©ployer une VM nommer Windows01 √† partir du Template et int√©gration automatique dans le domaine avec sysprep
	- [x] Est ce que Windows01 a bien √©t√© int√©grer dans le domaine automatiquement ?
	- [x] Cr√©er un fichier test.txt sur le bureau de Windows01, ouvrer le et ouvrer autre fen√™tre Windows gestionnaire des taches
	- [x] Effectuer un snapshot avec prise de m√©moire vive
	- [x] Supprimer le fichier test.txt
	- [x] Restaurer le snapshot
	- [x] Qu'est ce qu'il se passe ?
- [x] Importer l'OVF mis √† disposition
	- [x] Nom : StressVM01
	- [x] Laisser tout par d√©faut

# Installation
## vCenter Server
### Installation
Il est n√©cessaire de cr√©er son enregistrement DNS avant son installation. 
Sur la cl√© USB avec l'iso de vCenter : 
üìÇ vcsa-ui-installer > win32 > installer.exe
Suivre l'installation et compl√©ter la configuration en fonction des besoins. 

![[Pasted image 20230405101224.png]]


[Ajouter une instance vCenter √† un domaine AD](https://docs.vmware.com/fr/VMware-vSphere/7.0/com.vmware.vsphere.authentication.doc/GUID-02C0861B-BC0D-4CDD-BF4E-53A60EF03B71.html)
![[Pasted image 20230405103854.png]]
![[Pasted image 20230405111937.png]]

### Configuration
#### Mappage de groupes AD
[Ajouter une source d'identit√© vCenter](https://docs.vmware.com/fr/VMware-vSphere/7.0/com.vmware.vsphere.authentication.doc/GUID-B23B1360-8838-4FF2-B074-71643C4CB040.html#GUID-B23B1360-8838-4FF2-B074-71643C4CB040)
![[Pasted image 20230405112003.png]]
![[Pasted image 20230405112039.png]]

#### Cr√©er un cluster
[Cr√©er un cluster dans vSphere](https://docs.vmware.com/fr/VMware-vSphere/7.0/com.vmware.vsphere.avail.doc/GUID-AC35EFDD-F8B7-4FAF-B946-6553D7BDBF31.html)
![[Pasted image 20230405113539.png]]

Pour permettre que le cluster soit op√©rationnel, il faut mettre en place ces conditions : 
-   V√©rifiez que toutes les machines virtuelles et leurs fichiers de configuration r√©sident sur des stockages partag√©s ;
-   V√©rifiez que les h√¥tes sont configur√©s pour acc√©der au stockage partag√©, afin de pouvoir mettre sous tension les machines virtuelles √† l'aide des diff√©rents h√¥tes dans le cluster ;
-   V√©rifiez que les h√¥tes sont configur√©s pour avoir acc√®s au r√©seau de machines virtuelles ;
-   V√©rifiez que vous utilisez des connexions r√©seau de gestion redondant pour vSphere HA ;
-   V√©rifiez que vous avez configur√© les h√¥tes avec au moins deux banques de donn√©es afin de fournir de la redondance au signal de pulsation de la banque de donn√©es vSphere HA ;
-   Connectez vSphere Client √† vCenter Server en utilisant un compte disposant des autorisations d'administrateur de cluster.

#### Activer vMotion
üìÇ ESXi02.tssr.local > Mise en r√©seau > Adapteurs VMKernel > vmk0 > 3 points > Modifier 
	ajouter le service vMotion

## Debian01
[Installer une VM sur vSphere](https://docs.vmware.com/fr/VMware-Horizon-7/7.13/virtual-desktops/GUID-385F7959-2595-4F11-BC9F-408831A2BD1F.html)

#### Installation de SSH
``` bash
#D√©sactiver la connexion SSH via l'utilisateur root
nano /etc/ssh/sshd_config
#Ajouter dans le fichier de config
PermitRootLogin no #disabled
/etc/init.d/sshd restart
```
![[Pasted image 20230405134940.png]]
![[Pasted image 20230405140906.png]]
#### Installation OpenVM Tools

``` bash
apt install open-vm-tools
```

![[Pasted image 20230405135425.png]]

### Configuration d√©finitive
![[Pasted image 20230405143616.png]]

## Windows01
![[Pasted image 20230405143537.png]]

## Clone - Template - Snapshot
### Fichier de personnalisation Windows
[Cr√©er un fichier de sp√©cification de personnalisation pour Windows](https://docs.vmware.com/fr/VMware-vSphere/7.0/com.vmware.vsphere.vm_admin.doc/GUID-CAEB6A70-D1CF-446E-BC64-EC42CDB47117.html)
![[Pasted image 20230405150635.png]]

### Clone Windows01 en Windows02
Le fichier sysprep permet l'int√©gration de la VM Windows02 directement dans le domaine tssr.local

![[Pasted image 20230405151215.png]]

### Transformer Windows01 en template
![[Pasted image 20230405152040.png]]

### Cr√©er Windows01 via template + sysprep
La machine Windows01 est bien int√©gr√©e directement dans le domaine. 
![[Pasted image 20230405152209.png]]

### Cr√©ation de snapshot
Le snapshot avec m√©moire vive permet de revenir au stade enregistr√© lors de ce snapshot.
Il est conseill√© de faire un snapshot lorsque la VM est √©teinte. Si ce n'est pas possible, on fait un snapshot avec la m√©moire vive int√©gr√©e, pour √©viter de la perte de donn√©es. 

![[Pasted image 20230405155402.png]]

## StressVM01
![[Pasted image 20230405163034.png]]

## Sch√©ma r√©seau
![[T√©l√©chargements\Pasted image 20230406112705.png]]
