# Roadmap

-   Installer un serveur 2012R2/2016/2019/2022  propre (ip fixe, nom unique)
-   Mettre un suffixe DNS pour avoir un FQDN du type ns1.bobdy.lan
-   Installer le Rôle DNS à partir de la console "Gérer Votre Serveur"
-   Mettre le DNS de votre IF sur 127.0.0.1
-   Vérifier la présence du service dans services.msc
-   Faire une résolution nslookup sur un nom de domaine internet
-   Vérifier la présence des binaires dans _%systemroot%\system32\_ à la lettre d et dans le dossier dns
-   Mettre à jour les roots-servers dns en les téléchargeant  via le site de l'internic  et les écrasant le fichier cache DNS
-   Modifier les propriétés générales du serveur  
-   Redirecteur
-   Logs à activer
-   Test de connexion (watchdog)
-   Analyser les logs existants et repérer un dialogue de résolution complet de nom entre votre hôte et [www.perdu.com](http://www.perdu.com/) (i.e) - tester un traffic sous Wireshark 
-   Choisir un nom de domaine unique et différent
-   Créer une zone de recherche directe principale
-   Créer une zone de recherche inversée principale
-   Créer un Record A pour votre serveur
-   Modifier le Record SOA et NS de vos 2 zones pour utiliser le nom pleinement qualifié de votre serveur DNS
-   Mettre comme serveur DNS préféré votre nouveau serveur pour l’hôte Windows 10 et le serveur (à priori déjà fait en 127.0.0.1)
-   Modifier le suffixe DNS sur la machine hôte
-   Ajouter des postes clients en Record A avec PTR
-   Ajouter le routeur le switch, le nas, l’access point et le serveur_fake en RECORD A
-   Ajouter les Alias CNAME
-   Ajouter un compte MX
-   Interroger l’annuaire à partir de NSLOOKUP sur l’hôte qui doit tout résoudre
-   Vérifier dans l’observateur d’évènement que les logs sont propres (no error, no warning)
-   Faites les best practices 
-   N’oubliez pas de configurer des exceptions dans le FireWall! (sur le port 53 en both (tcp/udp), si ce n'est pas déjà fait

BONUS
-   Créer un alias www sur votre serveur NS1 et installer SERVA32 pour faire un site web en 5 minutes
-   faire une exception dans le firewall pour le 80
-   Créer un Record TXT sur le serveur et interroger avec NSLOOKUP par l’hôte
-   Créer un Record LOC(ça dépend des versions) sur le serveur et interroger avec NSLOOKUP par l’hôte
-   Créer un serveur DNS secondaire sous 2012R2/2016/2019/2022  

NS2
-   créer un record A pour NS2 sur NS1
-   créer un NS sur NS1 pour NS2
-   installer le rôle sur NS2
-   créer deux zones secondaires (directe et inverse)
-   actualiser les 2 zones qui vont se peupler et vérifier l’équivalence des numéros de série
-   faire une panne (couper une interface réseau sur NS1) et continuer à surfer (failover)
-   Tester le Failover sur l'hôte Windows 10 via le surf web et le binaire nslookup (attention à son comportement)

# Mise en place

192.168.20.12/24
DNS préféré 1.1.1.1
Nom = NS12
nitou.lan

Créer une règle d'ouverture de port TCP + UDP en port 53
Créer une règle entrante ICMPv4 : permet le ping


Installer le rôle DNS uniquement.
![[Pasted image 20230109095137.png]]

Je change ensuite l'adressage IP de mon serveur DNS préféré pour 

![[Pasted image 20230109095741.png]]

Aller dans la console services.msc
Vérifier que j'ai le rôle serveur DNS actif.
![[Pasted image 20230109095850.png]]

Aller dans %windir%
> system32
Les fichiers DNS apparaissent dans le fichier system32, tout en bas. 

![[Pasted image 20230109101826.png]]

### dnsapi.dll
guide emmagasinant des informations et des instructions pour les fichiers exécutables. 
Plusieurs programmes peuvent partager le même fichier dnsapi.dll, permettant de sauvegarder une allocation mémoire indispensable. 
C'est un module qui contient des fonctions employées par le DNS Client api. Il contient un code machine. Le fichier est chargé dans la mémoire RAM et fonctionne comme un processus DNS Client API DLL. 

### dnscacheugc.exe
= dns cache unattend generic command

### dnscmd.exe
interface de ligne de commande pour la gestion des serveurs DNS. 
https://learn.microsoft.com/fr-fr/windows-server/administration/windows-commands/dnscmd

### dnscmmc.dll
Fichier exécutable contenant un code machine.
Chargé dans la RAM et y fonctionne comme un processus windows.

### dnsext.dll
fichier DLL (= bibliothèque de liens dynamiques)
création de routines logicielles chargées de s'intégrer à des systèmes distants ou de travailler avec des périphériques de stockage. L'utilisation du fichier dnsext.dll peut également être observée dans les applications multiplateformes.

### dnshsc.dll
??

### dnsmgmt.msc
commande pour accéder à l'interface de gestion du DNS.
![[Pasted image 20230109105908.png]]

### dnsmgr.dll
### dnsperf.dll
### dnsrslvr.dll

Les MAJ automatique se font quand on a un AD
![[Pasted image 20230109110109.png]]

Ajout dans la zone de recherche directe puis dans la zone de recherche inversée
Je note l'adresse IP avec uniquement les bits en /24 car le masque est en /24
![[Pasted image 20230109110540.png]]
je vois bien le fichier qui s'est créé : nitou.lan.dns
si je l'ouvre : 
![[Pasted image 20230109110837.png]]

On définit une zone vierge qui permet ensuite d'enregistrer un annuaire local d'adresse. 
J'enregistre donc tout mes éléments dans ma zone DNS. 
Je peux ensuite y accéder via mon client Windows 10, sur un navigateur web. 
Par exemple si je recherche :
https://routeur.nitou.lan:666


Faire un clone de ma machine. 
#### Clone
Copier coller de ma machine
#### Snapshot
Enregistrement de l'état de ma machine à un moment donné.
Il est duplicable.

Définir une nouvelle zone DNS secondaire. Elle copie automatiquement les zones du DNS principal.
Puis créer une délégation DNS pour le DNS secondaire

## Qu'est ce qu'un redirecteur conditionnel ?
Un redirecteur inconditionnel c'est quand on ne peut pas gérer en local, donc on renvoie tout vers un autre serveur DNS (par exemple 1.1.1.1)
Un redirecteur conditionnel renvoie en fonction de l'adresse (nom de domaine) à un type de serveur DNS précis.

## Qu'est ce qu'un point d'approbation ? 
Clé de chiffrement publique pour une zone signée. Elles sont configurées sur chaque serveur DNS ne faisant pas autorité qui tente de valider des données DNS. 

## Best Practice Analyzer
sur le gestionnaire de serveur
![[Pasted image 20230109142441.png]]
Permet de voir les erreurs et recommandations proposées par Windows Server.

## Unbound
https://fr.wikipedia.org/wiki/Unbound
https://nlnetlabs.nl/projects/unbound/about/

