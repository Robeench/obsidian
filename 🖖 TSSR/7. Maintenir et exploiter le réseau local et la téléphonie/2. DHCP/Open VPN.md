Connexion au PFSense

installed packages
openvpn-client-export

üìÇ system > general setup
renommer les diff√©rents √©l√©ments
DNS = √† d√©finir

üìÇ system > dns resolver
d√©finir une infra si besoin

## Certification

üìÇ system > certificate manager > CAs
d√©truire la certificate authorities pr√©c√©dente s'il en existe une.

### Cr√©ation d'une autorit√© de certification
descriptive name = CA_INFRA_LAN
Trust store = disabled
key type = RSA
	2048 bits
digest algorithm = sha256
(toujours rester dans les standards du moment, √ßa permet que chaque machine puisse communiquer facilement et ne soit pas bloqu√©, notamment par un cryptage trop important)
lifetime = 3650
common name = internal_ca
country code = FR
	CVDL
	Tours
	CEFIM
	IT

![[capture_pf1 1.png]]

üìÇ system > certificate manager > certificates > edit
certificate type = server certificate

![[capture_pf2.png]]

Une fois cr√©√©e, mon autorit√© de certification n'est plus modifiable.

## Server
üìÇ vpn > openvpn > servers
client2site_INFRA_LAN
server mode = remote access (SSL / TLS + User Auth)
backend for authentification = local database (possibilit√© d'ajouter des bases de donn√©es)
device mode = TUN Layer 3 Tunnel Mode
protocole = UDP
interface = WAN
local port = 1194
TLS configuration = use a TLS key
peer certificate authority = le certificat que je viens de cr√©er
DH parameter length = 2048 bits
ECDH curve = default
data encryption negociation = enable
data encryption algorithm = default
IPv4 tunnel network = 10.0.0.0/24
IPv4 local network = 192.168.20.0/24 (s√©paration par des virgules)
ping settings / inactive = 300
DNS default domain = enable (√ßa ne g√™ne pas le DNS par d√©faut de l'utilisateur)
	infra.lan
	DNS server 1 : 192.168.20.254

![[capture_pf3.png]]

## Users
üìÇ system user manager > users
Cr√©er un utilisateur
certificate authority : d√©finir l'utilisateur

![[capture_pf4.png]]

## Firewall
üìÇ firewall > rules > LAN
UDP
WAN address
Port custom 1194

![[capture_pf5.png]]

üìÇ firewall > rules > openVPN
cr√©er une r√®gle passoire qui laisse tout passer

![[capture_pf6.png]]
